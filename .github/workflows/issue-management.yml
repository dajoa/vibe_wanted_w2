name: Issue Management

on:
  issues:
    types: [opened, edited, closed, reopened]
  issue_comment:
    types: [created]

jobs:
  issue-comment:
    if: github.event.action == 'opened'
    runs-on: ubuntu-latest
    permissions:
      issues: write
    
    steps:
    - name: ì´ìŠˆ ìƒì„± ì‹œ ì•ˆë‚´ ëŒ“ê¸€ ì¶”ê°€
      uses: actions/github-script@v7
      with:
        script: |
          const body = `
          ## ì´ìŠˆ ë“±ë¡ ì•ˆë‚´ ğŸ‘‹
          
          ì´ìŠˆë¥¼ ë“±ë¡í•´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤! ë¹ ë¥¸ ì²˜ë¦¬ë¥¼ ìœ„í•´ ë‹¤ìŒ ì‚¬í•­ë“¤ì„ í™•ì¸í•´ì£¼ì„¸ìš”:
          
          ### ë²„ê·¸ ì‹ ê³ ì˜ ê²½ìš°
          - [ ] ë¬¸ì œ ìƒí™©ì„ ëª…í™•í•˜ê²Œ ì„¤ëª…í–ˆë‚˜ìš”?
          - [ ] ì¬í˜„ ë‹¨ê³„ë¥¼ í¬í•¨í–ˆë‚˜ìš”?
          - [ ] ì˜ˆìƒ ê²°ê³¼ì™€ ì‹¤ì œ ê²°ê³¼ë¥¼ êµ¬ë¶„í–ˆë‚˜ìš”?
          - [ ] í™˜ê²½ ì •ë³´ (OS, Python ë²„ì „ ë“±)ë¥¼ í¬í•¨í–ˆë‚˜ìš”?
          - [ ] ìŠ¤í¬ë¦°ìƒ·ì´ë‚˜ ë¡œê·¸ë¥¼ ì²¨ë¶€í–ˆë‚˜ìš”?
          
          ### ê¸°ëŠ¥ ìš”ì²­ì˜ ê²½ìš°
          - [ ] ìš”ì²­í•˜ëŠ” ê¸°ëŠ¥ì„ ëª…í™•í•˜ê²Œ ì„¤ëª…í–ˆë‚˜ìš”?
          - [ ] ì‚¬ìš© ì‚¬ë¡€(Use Case)ë¥¼ í¬í•¨í–ˆë‚˜ìš”?
          - [ ] ê¸°ëŒ€ íš¨ê³¼ë¥¼ ì„¤ëª…í–ˆë‚˜ìš”?
          
          ### ì§ˆë¬¸ì˜ ê²½ìš°
          - [ ] ë¬´ì—‡ì„ ì‹œë„í–ˆëŠ”ì§€ ì„¤ëª…í–ˆë‚˜ìš”?
          - [ ] ê´€ë ¨ ì½”ë“œë‚˜ ì„¤ì •ì„ í¬í•¨í–ˆë‚˜ìš”?
          - [ ] ë¬¸ì„œë¥¼ ë¨¼ì € í™•ì¸í–ˆë‚˜ìš”?
          
          ë‹´ë‹¹ìê°€ ë°°ì •ë˜ì–´ ë¹ ë¥´ê²Œ ê²€í† í•˜ê² ìŠµë‹ˆë‹¤!
          
          ---
          *ì´ ëŒ“ê¸€ì€ ìë™ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.*
          `;
          
          await github.rest.issues.createComment({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: body
          });

  issue-assigner:
    if: github.event.action == 'opened'
    runs-on: ubuntu-latest
    permissions:
      issues: write
    
    steps:
    - name: ì´ìŠˆ íƒ€ì…ë³„ ë‹´ë‹¹ì ìë™ í• ë‹¹
      uses: actions/github-script@v7
      with:
        script: |
          const issue = context.payload.issue;
          const title = issue.title.toLowerCase();
          const body = issue.body ? issue.body.toLowerCase() : '';
          const labels = issue.labels.map(label => label.name.toLowerCase());
          
          let assignees = [];
          
          // ì´ìŠˆ íƒ€ì…ë³„ ë‹´ë‹¹ì í• ë‹¹ (ì‹¤ì œ GitHub ì‚¬ìš©ìëª…ìœ¼ë¡œ ë³€ê²½ í•„ìš”)
          if (title.includes('bug') || title.includes('ë²„ê·¸') || labels.includes('bug')) {
            // ë²„ê·¸ëŠ” ë°±ì—”ë“œ/í”„ë¡ íŠ¸ì—”ë“œ ë‹´ë‹¹ìì—ê²Œ í• ë‹¹
            if (title.includes('backend') || body.includes('backend')) {
              assignees.push('backend-maintainer'); // ì‹¤ì œ ì‚¬ìš©ìëª…ìœ¼ë¡œ ë³€ê²½
            } else if (title.includes('frontend') || body.includes('frontend')) {
              assignees.push('frontend-maintainer'); // ì‹¤ì œ ì‚¬ìš©ìëª…ìœ¼ë¡œ ë³€ê²½
            } else {
              assignees.push('project-lead'); // ì‹¤ì œ ì‚¬ìš©ìëª…ìœ¼ë¡œ ë³€ê²½
            }
          } else if (title.includes('feature') || title.includes('ê¸°ëŠ¥') || labels.includes('enhancement')) {
            // ìƒˆ ê¸°ëŠ¥ì€ í”„ë¡œì íŠ¸ ë¦¬ë”ì—ê²Œ
            assignees.push('project-lead'); // ì‹¤ì œ ì‚¬ìš©ìëª…ìœ¼ë¡œ ë³€ê²½
          } else if (title.includes('docs') || title.includes('ë¬¸ì„œ') || labels.includes('documentation')) {
            // ë¬¸ì„œëŠ” ë¬¸ì„œ ë‹´ë‹¹ìì—ê²Œ
            assignees.push('docs-maintainer'); // ì‹¤ì œ ì‚¬ìš©ìëª…ìœ¼ë¡œ ë³€ê²½
          } else if (title.includes('question') || title.includes('ì§ˆë¬¸') || labels.includes('question')) {
            // ì§ˆë¬¸ì€ í”„ë¡œì íŠ¸ ë¦¬ë”ì—ê²Œ
            assignees.push('project-lead'); // ì‹¤ì œ ì‚¬ìš©ìëª…ìœ¼ë¡œ ë³€ê²½
          }
          
          // í• ë‹¹ìê°€ ì—†ìœ¼ë©´ ì´ìŠˆ ìƒì„±ìë¥¼ í• ë‹¹
          if (assignees.length === 0) {
            assignees.push(issue.user.login);
          }
          
          // ì‹¤ì œ GitHub ì‚¬ìš©ìê°€ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸ í›„ í• ë‹¹
          // ì—¬ê¸°ì„œëŠ” ì£¼ì„ ì²˜ë¦¬í•˜ê³  ì‹¤ì œ ì‚¬ìš© ì‹œ ì‚¬ìš©ìëª…ì„ ë³€ê²½í•´ì•¼ í•¨
          /*
          try {
            await github.rest.issues.addAssignees({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              assignees: assignees
            });
          } catch (error) {
            console.log('í• ë‹¹ ì‹¤íŒ¨:', error.message);
          }
          */
          
          // ëŒ€ì‹  ëŒ“ê¸€ë¡œ í• ë‹¹ ì •ë³´ ì•ˆë‚´
          const assigneeComment = `
          ## ë‹´ë‹¹ì í• ë‹¹ ì•ˆë‚´ ğŸ‘¥
          
          ì´ìŠˆ íƒ€ì…ì— ë”°ë¼ ë‹¤ìŒ ë‹´ë‹¹ìë“¤ì´ ê²€í† í•  ì˜ˆì •ì…ë‹ˆë‹¤:
          - ${assignees.join(', ')}
          
          ---
          *ì‹¤ì œ í• ë‹¹ì„ ìœ„í•´ì„œëŠ” GitHub Actions ì„¤ì •ì—ì„œ ì‚¬ìš©ìëª…ì„ ìˆ˜ì •í•´ì£¼ì„¸ìš”.*
          `;
          
          await github.rest.issues.createComment({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: assigneeComment
          });

  issue-labeler:
    if: github.event.action == 'opened' || github.event.action == 'edited'
    runs-on: ubuntu-latest
    permissions:
      issues: write
    
    steps:
    - name: í‚¤ì›Œë“œ ê¸°ë°˜ ìë™ ë¼ë²¨ë§
      uses: actions/github-script@v7
      with:
        script: |
          const issue = context.payload.issue;
          const title = issue.title.toLowerCase();
          const body = issue.body ? issue.body.toLowerCase() : '';
          
          const labels = new Set();
          
          // ì´ìŠˆ íƒ€ì… ë¼ë²¨ë§
          if (title.includes('bug') || title.includes('ë²„ê·¸') || title.includes('ì˜¤ë¥˜') || title.includes('error')) {
            labels.add('bug');
          }
          if (title.includes('feature') || title.includes('ê¸°ëŠ¥') || title.includes('ì¶”ê°€')) {
            labels.add('enhancement');
          }
          if (title.includes('docs') || title.includes('ë¬¸ì„œ') || title.includes('documentation')) {
            labels.add('documentation');
          }
          if (title.includes('question') || title.includes('ì§ˆë¬¸') || title.includes('help')) {
            labels.add('question');
          }
          if (title.includes('test') || title.includes('í…ŒìŠ¤íŠ¸')) {
            labels.add('tests');
          }
          
          // ì»´í¬ë„ŒíŠ¸ë³„ ë¼ë²¨ë§
          if (title.includes('backend') || body.includes('backend') || body.includes('fastapi')) {
            labels.add('backend');
          }
          if (title.includes('frontend') || body.includes('frontend') || body.includes('streamlit')) {
            labels.add('frontend');
          }
          if (title.includes('agent') || body.includes('agent') || body.includes('langgraph')) {
            labels.add('agent');
          }
          if (title.includes('api') || body.includes('api')) {
            labels.add('api');
          }
          
          // ìš°ì„ ìˆœìœ„ ë¼ë²¨ë§
          if (title.includes('urgent') || title.includes('ê¸´ê¸‰') || title.includes('critical')) {
            labels.add('priority/high');
          } else if (title.includes('low') || title.includes('ë‚®ìŒ')) {
            labels.add('priority/low');
          } else {
            labels.add('priority/medium');
          }
          
          // ë‚œì´ë„ ë¼ë²¨ë§
          if (title.includes('beginner') || title.includes('ì´ˆë³´') || title.includes('easy')) {
            labels.add('good first issue');
          }
          if (title.includes('help wanted') || title.includes('ë„ì›€')) {
            labels.add('help wanted');
          }
          
          if (labels.size > 0) {
            await github.rest.issues.addLabels({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              labels: Array.from(labels)
            });
          }

  issue-status-update:
    if: github.event.action == 'closed'
    runs-on: ubuntu-latest
    permissions:
      issues: write
    
    steps:
    - name: ì´ìŠˆ ì™„ë£Œ ì‹œ ëŒ“ê¸€ ì¶”ê°€
      uses: actions/github-script@v7
      with:
        script: |
          const body = `
          ## ì´ìŠˆ ì™„ë£Œ ğŸ‰
          
          ì´ìŠˆê°€ í•´ê²°ë˜ì—ˆìŠµë‹ˆë‹¤! ì´ìš©í•´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.
          
          ### í›„ì† ì¡°ì¹˜
          - [ ] í•´ê²°ì±…ì´ ë§Œì¡±ìŠ¤ëŸ¬ìš°ì‹ ê°€ìš”?
          - [ ] ì¶”ê°€ ê°œì„ ì‚¬í•­ì´ ìˆë‚˜ìš”?
          - [ ] ê´€ë ¨ëœ ë‹¤ë¥¸ ì´ìŠˆê°€ ìˆë‚˜ìš”?
          
          ë¬¸ì œê°€ ì§€ì†ë˜ê±°ë‚˜ ì¶”ê°€ ì§ˆë¬¸ì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“  ìƒˆë¡œìš´ ì´ìŠˆë¥¼ ë“±ë¡í•´ì£¼ì„¸ìš”!
          
          ---
          *ì´ ëŒ“ê¸€ì€ ìë™ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.*
          `;
          
          await github.rest.issues.createComment({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: body
          }); 